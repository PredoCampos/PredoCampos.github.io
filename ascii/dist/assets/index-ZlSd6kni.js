(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))h(u);new MutationObserver(u=>{for(const o of u)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&h(l)}).observe(document,{childList:!0,subtree:!0});function r(u){const o={};return u.integrity&&(o.integrity=u.integrity),u.referrerPolicy&&(o.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?o.credentials="include":u.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function h(u){if(u.ep)return;u.ep=!0;const o=r(u);fetch(u.href,o)}})();function ze(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var P={},ce={},D={},be;function De(){if(be)return D;be=1,Object.defineProperty(D,"__esModule",{value:!0}),D.loop=D.conditional=D.parse=void 0;var s=function h(u,o){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:l;if(Array.isArray(o))o.forEach(function(m){return h(u,m,l,y)});else if(typeof o=="function")o(u,l,y,h);else{var v=Object.keys(o)[0];Array.isArray(o[v])?(y[v]={},h(u,o[v],l,y[v])):y[v]=o[v](u,l,y,h)}return l};D.parse=s;var d=function(u,o){return function(l,y,v,m){o(l,y,v)&&m(l,u,y,v)}};D.conditional=d;var r=function(u,o){return function(l,y,v,m){for(var n=[],e=l.pos;o(l,y,v);){var t={};if(m(l,u,y,t),l.pos===e)break;e=l.pos,n.push(t)}return n}};return D.loop=r,D}var _={},_e;function Te(){if(_e)return _;_e=1,Object.defineProperty(_,"__esModule",{value:!0}),_.readBits=_.readArray=_.readUnsigned=_.readString=_.peekBytes=_.readBytes=_.peekByte=_.readByte=_.buildStream=void 0;var s=function(e){return{data:e,pos:0}};_.buildStream=s;var d=function(){return function(e){return e.data[e.pos++]}};_.readByte=d;var r=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(t){return t.data[t.pos+e]}};_.peekByte=r;var h=function(e){return function(t){return t.data.subarray(t.pos,t.pos+=e)}};_.readBytes=h;var u=function(e){return function(t){return t.data.subarray(t.pos,t.pos+e)}};_.peekBytes=u;var o=function(e){return function(t){return Array.from(h(e)(t)).map(function(f){return String.fromCharCode(f)}).join("")}};_.readString=o;var l=function(e){return function(t){var f=h(2)(t);return e?(f[1]<<8)+f[0]:(f[0]<<8)+f[1]}};_.readUnsigned=l;var y=function(e,t){return function(f,g,c){for(var i=typeof t=="function"?t(f,g,c):t,a=h(e),p=new Array(i),w=0;w<i;w++)p[w]=a(f);return p}};_.readArray=y;var v=function(e,t,f){for(var g=0,c=0;c<f;c++)g+=e[t+c]&&Math.pow(2,f-c-1);return g},m=function(e){return function(t){for(var f=d()(t),g=new Array(8),c=0;c<8;c++)g[7-c]=!!(f&1<<c);return Object.keys(e).reduce(function(i,a){var p=e[a];return p.length?i[a]=v(g,p.index,p.length):i[a]=g[p.index],i},{})}};return _.readBits=m,_}var ke;function Ge(){return ke||(ke=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var d=De(),r=Te(),h={blocks:function(t){for(var f=0,g=[],c=t.data.length,i=0,a=(0,r.readByte)()(t);a!==f&&a;a=(0,r.readByte)()(t)){if(t.pos+a>=c){var p=c-t.pos;g.push((0,r.readBytes)(p)(t)),i+=p;break}g.push((0,r.readBytes)(a)(t)),i+=a}for(var w=new Uint8Array(i),b=0,x=0;x<g.length;x++)w.set(g[x],b),b+=g[x].length;return w}},u=(0,d.conditional)({gce:[{codes:(0,r.readBytes)(2)},{byteSize:(0,r.readByte)()},{extras:(0,r.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,r.readUnsigned)(!0)},{transparentColorIndex:(0,r.readByte)()},{terminator:(0,r.readByte)()}]},function(e){var t=(0,r.peekBytes)(2)(e);return t[0]===33&&t[1]===249}),o=(0,d.conditional)({image:[{code:(0,r.readByte)()},{descriptor:[{left:(0,r.readUnsigned)(!0)},{top:(0,r.readUnsigned)(!0)},{width:(0,r.readUnsigned)(!0)},{height:(0,r.readUnsigned)(!0)},{lct:(0,r.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,d.conditional)({lct:(0,r.readArray)(3,function(e,t,f){return Math.pow(2,f.descriptor.lct.size+1)})},function(e,t,f){return f.descriptor.lct.exists}),{data:[{minCodeSize:(0,r.readByte)()},h]}]},function(e){return(0,r.peekByte)()(e)===44}),l=(0,d.conditional)({text:[{codes:(0,r.readBytes)(2)},{blockSize:(0,r.readByte)()},{preData:function(t,f,g){return(0,r.readBytes)(g.text.blockSize)(t)}},h]},function(e){var t=(0,r.peekBytes)(2)(e);return t[0]===33&&t[1]===1}),y=(0,d.conditional)({application:[{codes:(0,r.readBytes)(2)},{blockSize:(0,r.readByte)()},{id:function(t,f,g){return(0,r.readString)(g.blockSize)(t)}},h]},function(e){var t=(0,r.peekBytes)(2)(e);return t[0]===33&&t[1]===255}),v=(0,d.conditional)({comment:[{codes:(0,r.readBytes)(2)},h]},function(e){var t=(0,r.peekBytes)(2)(e);return t[0]===33&&t[1]===254}),m=[{header:[{signature:(0,r.readString)(3)},{version:(0,r.readString)(3)}]},{lsd:[{width:(0,r.readUnsigned)(!0)},{height:(0,r.readUnsigned)(!0)},{gct:(0,r.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,r.readByte)()},{pixelAspectRatio:(0,r.readByte)()}]},(0,d.conditional)({gct:(0,r.readArray)(3,function(e,t){return Math.pow(2,t.lsd.gct.size+1)})},function(e,t){return t.lsd.gct.exists}),{frames:(0,d.loop)([u,y,v,o,l],function(e){var t=(0,r.peekByte)()(e);return t===33||t===44})}],n=m;s.default=n}(ce)),ce}var Y={},Ie;function Ne(){if(Ie)return Y;Ie=1,Object.defineProperty(Y,"__esModule",{value:!0}),Y.deinterlace=void 0;var s=function(r,h){for(var u=new Array(r.length),o=r.length/h,l=function(f,g){var c=r.slice(g*h,(g+1)*h);u.splice.apply(u,[f*h,h].concat(c))},y=[0,4,2,1],v=[8,8,4,2],m=0,n=0;n<4;n++)for(var e=y[n];e<o;e+=v[n])l(e,m),m++;return u};return Y.deinterlace=s,Y}var Z={},Ce;function He(){if(Ce)return Z;Ce=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.lzw=void 0;var s=function(r,h,u){var o=4096,l=-1,y=u,v,m,n,e,t,f,g,k,c,i,C,a,L,I,F,W,p=new Array(u),w=new Array(o),b=new Array(o),x=new Array(o+1);for(a=r,m=1<<a,t=m+1,v=m+2,g=l,e=a+1,n=(1<<e)-1,c=0;c<m;c++)w[c]=0,b[c]=c;var C,k,L,I,W,F;for(C=k=L=I=W=F=0,i=0;i<y;){if(I===0){if(k<e){C+=h[F]<<k,k+=8,F++;continue}if(c=C&n,C>>=e,k-=e,c>v||c==t)break;if(c==m){e=a+1,n=(1<<e)-1,v=m+2,g=l;continue}if(g==l){x[I++]=b[c],g=c,L=c;continue}for(f=c,c==v&&(x[I++]=L,c=g);c>m;)x[I++]=b[c],c=w[c];L=b[c]&255,x[I++]=L,v<o&&(w[v]=g,b[v]=L,v++,(v&n)===0&&v<o&&(e++,n+=v)),g=f}I--,p[W++]=x[I],i++}for(i=W;i<y;i++)p[i]=0;return p};return Z.lzw=s,Z}var Be;function je(){if(Be)return P;Be=1,Object.defineProperty(P,"__esModule",{value:!0}),P.decompressFrames=P.decompressFrame=P.parseGIF=void 0;var s=o(Ge()),d=De(),r=Te(),h=Ne(),u=He();function o(n){return n&&n.__esModule?n:{default:n}}var l=function(e){var t=new Uint8Array(e);return(0,d.parse)((0,r.buildStream)(t),s.default)};P.parseGIF=l;var y=function(e){for(var t=e.pixels.length,f=new Uint8ClampedArray(t*4),g=0;g<t;g++){var c=g*4,i=e.pixels[g],a=e.colorTable[i]||[0,0,0];f[c]=a[0],f[c+1]=a[1],f[c+2]=a[2],f[c+3]=i!==e.transparentIndex?255:0}return f},v=function(e,t,f){if(!e.image){console.warn("gif frame does not have associated image.");return}var g=e.image,c=g.descriptor.width*g.descriptor.height,i=(0,u.lzw)(g.data.minCodeSize,g.data.blocks,c);g.descriptor.lct.interlaced&&(i=(0,h.deinterlace)(i,g.descriptor.width));var a={pixels:i,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return g.descriptor.lct&&g.descriptor.lct.exists?a.colorTable=g.lct:a.colorTable=t,e.gce&&(a.delay=(e.gce.delay||10)*10,a.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(a.transparentIndex=e.gce.transparentColorIndex)),f&&(a.patch=y(a)),a};P.decompressFrame=v;var m=function(e,t){return e.frames.filter(function(f){return f.image}).map(function(f){return v(f,e.gct,t)})};return P.decompressFrames=m,P}var Ee=je();function re(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var de={exports:{}},Le;function $e(){return Le||(Le=1,function(s,d){(function(r){s.exports=r()})(function(){return function r(h,u,o){function l(m,n){if(!u[m]){if(!h[m]){var e=typeof re=="function"&&re;if(!n&&e)return e(m,!0);if(y)return y(m,!0);var t=new Error("Cannot find module '"+m+"'");throw t.code="MODULE_NOT_FOUND",t}var f=u[m]={exports:{}};h[m][0].call(f.exports,function(g){var c=h[m][1][g];return l(c||g)},f,f.exports,r,h,u,o)}return u[m].exports}for(var y=typeof re=="function"&&re,v=0;v<o.length;v++)l(o[v]);return l}({1:[function(r,h,u){function o(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}h.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.prototype.setMaxListeners=function(n){if(!y(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},o.prototype.emit=function(n){var e,t,f,g,c,i;if(this._events||(this._events={}),n==="error"&&(!this._events.error||v(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var a=new Error('Uncaught, unspecified "error" event. ('+e+")");throw a.context=e,a}if(t=this._events[n],m(t))return!1;if(l(t))switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:g=Array.prototype.slice.call(arguments,1),t.apply(this,g)}else if(v(t))for(g=Array.prototype.slice.call(arguments,1),i=t.slice(),f=i.length,c=0;c<f;c++)i[c].apply(this,g);return!0},o.prototype.addListener=function(n,e){var t;if(!l(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",n,l(e.listener)?e.listener:e),this._events[n]?v(this._events[n])?this._events[n].push(e):this._events[n]=[this._events[n],e]:this._events[n]=e,v(this._events[n])&&!this._events[n].warned&&(m(this._maxListeners)?t=o.defaultMaxListeners:t=this._maxListeners,t&&t>0&&this._events[n].length>t&&(this._events[n].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[n].length),typeof console.trace=="function"&&console.trace())),this},o.prototype.on=o.prototype.addListener,o.prototype.once=function(n,e){if(!l(e))throw TypeError("listener must be a function");var t=!1;function f(){this.removeListener(n,f),t||(t=!0,e.apply(this,arguments))}return f.listener=e,this.on(n,f),this},o.prototype.removeListener=function(n,e){var t,f,g,c;if(!l(e))throw TypeError("listener must be a function");if(!this._events||!this._events[n])return this;if(t=this._events[n],g=t.length,f=-1,t===e||l(t.listener)&&t.listener===e)delete this._events[n],this._events.removeListener&&this.emit("removeListener",n,e);else if(v(t)){for(c=g;c-- >0;)if(t[c]===e||t[c].listener&&t[c].listener===e){f=c;break}if(f<0)return this;t.length===1?(t.length=0,delete this._events[n]):t.splice(f,1),this._events.removeListener&&this.emit("removeListener",n,e)}return this},o.prototype.removeAllListeners=function(n){var e,t;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[n]&&delete this._events[n],this;if(arguments.length===0){for(e in this._events)e!=="removeListener"&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(t=this._events[n],l(t))this.removeListener(n,t);else if(t)for(;t.length;)this.removeListener(n,t[t.length-1]);return delete this._events[n],this},o.prototype.listeners=function(n){var e;return!this._events||!this._events[n]?e=[]:l(this._events[n])?e=[this._events[n]]:e=this._events[n].slice(),e},o.prototype.listenerCount=function(n){if(this._events){var e=this._events[n];if(l(e))return 1;if(e)return e.length}return 0},o.listenerCount=function(n,e){return n.listenerCount(e)};function l(n){return typeof n=="function"}function y(n){return typeof n=="number"}function v(n){return typeof n=="object"&&n!==null}function m(n){return n===void 0}},{}],2:[function(r,h,u){var o,l,y,v,m;m=navigator.userAgent.toLowerCase(),v=navigator.platform.toLowerCase(),o=m.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],y=o[1]==="ie"&&document.documentMode,l={name:o[1]==="version"?o[3]:o[1],version:y||parseFloat(o[1]==="opera"&&o[4]?o[4]:o[2]),platform:{name:m.match(/ip(?:ad|od|hone)/)?"ios":(m.match(/(?:webos|android)/)||v.match(/mac|win|linux/)||["other"])[0]}},l[l.name]=!0,l[l.name+parseInt(l.version,10)]=!0,l.platform[l.platform.name]=!0,h.exports=l},{}],3:[function(r,h,u){var o,l,y,v=function(t,f){for(var g in f)m.call(f,g)&&(t[g]=f[g]);function c(){this.constructor=t}return c.prototype=f.prototype,t.prototype=new c,t.__super__=f.prototype,t},m={}.hasOwnProperty,n=[].indexOf||function(t){for(var f=0,g=this.length;f<g;f++)if(f in this&&this[f]===t)return f;return-1},e=[].slice;o=r("events").EventEmitter,y=r("./browser.coffee"),l=function(t){var f,g;v(c,t),f={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},g={delay:500,copy:!1};function c(i){var a,p,w;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(i);for(p in f)w=f[p],(a=this.options)[p]==null&&(a[p]=w)}return c.prototype.setOption=function(i,a){if(this.options[i]=a,this._canvas!=null&&(i==="width"||i==="height"))return this._canvas[i]=a},c.prototype.setOptions=function(i){var a,p,w;p=[];for(a in i)m.call(i,a)&&(w=i[a],p.push(this.setOption(a,w)));return p},c.prototype.addFrame=function(i,a){var p,w;a==null&&(a={}),p={},p.transparent=this.options.transparent;for(w in g)p[w]=a[w]||g[w];if(this.options.width==null&&this.setOption("width",i.width),this.options.height==null&&this.setOption("height",i.height),typeof ImageData<"u"&&ImageData!==null&&i instanceof ImageData)p.data=i.data;else if(typeof CanvasRenderingContext2D<"u"&&CanvasRenderingContext2D!==null&&i instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext<"u"&&WebGLRenderingContext!==null&&i instanceof WebGLRenderingContext)a.copy?p.data=this.getContextData(i):p.context=i;else if(i.childNodes!=null)a.copy?p.data=this.getImageData(i):p.image=i;else throw new Error("Invalid image");return this.frames.push(p)},c.prototype.render=function(){var i,a,p;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=(function(){var w,b,x;for(x=[],w=0,b=this.frames.length;0<=b?w<b:w>b;0<=b?++w:--w)x.push(null);return x}).call(this),a=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(i=0,p=a;0<=p?i<p:i>p;0<=p?++i:--i)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},c.prototype.abort=function(){for(var i;i=this.activeWorkers.shift(),i!=null;)this.log("killing active worker"),i.terminate();return this.running=!1,this.emit("abort")},c.prototype.spawnWorkers=function(){var i,a,p;return i=Math.min(this.options.workers,this.frames.length),(function(){p=[];for(var w=a=this.freeWorkers.length;a<=i?w<i:w>i;a<=i?w++:w--)p.push(w);return p}).apply(this).forEach(function(w){return function(b){var x;return w.log("spawning worker "+b),x=new Worker(w.options.workerScript),x.onmessage=function(C){return w.activeWorkers.splice(w.activeWorkers.indexOf(x),1),w.freeWorkers.push(x),w.frameFinished(C.data)},w.freeWorkers.push(x)}}(this)),i},c.prototype.frameFinished=function(i){var a,p;if(this.log("frame "+i.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[i.index]=i,this.options.globalPalette===!0&&(this.options.globalPalette=i.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(a=1,p=this.freeWorkers.length;1<=p?a<p:a>p;1<=p?++a:--a)this.renderNextFrame();return n.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},c.prototype.finishRendering=function(){var i,a,p,w,b,x,C,k,L,I,W,F,xe,se,le,ue;for(k=0,se=this.imageParts,b=0,L=se.length;b<L;b++)a=se[b],k+=(a.data.length-1)*a.pageSize+a.cursor;for(k+=a.pageSize-a.cursor,this.log("rendering finished - filesize "+Math.round(k/1e3)+"kb"),i=new Uint8Array(k),F=0,le=this.imageParts,x=0,I=le.length;x<I;x++)for(a=le[x],ue=a.data,p=C=0,W=ue.length;C<W;p=++C)xe=ue[p],i.set(xe,F),p===a.data.length-1?F+=a.cursor:F+=a.pageSize;return w=new Blob([i],{type:"image/gif"}),this.emit("finished",w,i)},c.prototype.renderNextFrame=function(){var i,a,p;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return i=this.frames[this.nextFrame++],p=this.freeWorkers.shift(),a=this.getTask(i),this.log("starting frame "+(a.index+1)+" of "+this.frames.length),this.activeWorkers.push(p),p.postMessage(a)},c.prototype.getContextData=function(i){return i.getImageData(0,0,this.options.width,this.options.height).data},c.prototype.getImageData=function(i){var a;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),a=this._canvas.getContext("2d"),a.setFill=this.options.background,a.fillRect(0,0,this.options.width,this.options.height),a.drawImage(i,0,0),this.getContextData(a)},c.prototype.getTask=function(i){var a,p;if(a=this.frames.indexOf(i),p={index:a,last:a===this.frames.length-1,delay:i.delay,transparent:i.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:y.name==="chrome"},i.data!=null)p.data=i.data;else if(i.context!=null)p.data=this.getContextData(i.context);else if(i.image!=null)p.data=this.getImageData(i.image);else throw new Error("Invalid frame");return p},c.prototype.log=function(){var i;if(i=1<=arguments.length?e.call(arguments,0):[],!!this.options.debug)return console.log.apply(console,i)},c}(o),h.exports=l},{"./browser.coffee":2,events:1}]},{},[3])(3)})}(de)),de.exports}var Ve=$e();const Xe=ze(Ve),Se=document.getElementById("image-input"),Ke=document.getElementById("upload-container"),Ye=document.getElementById("image-preview"),Ze=document.querySelector(".image-preview-box"),Je=document.getElementById("content-area"),B=document.getElementById("output-canvas"),G=document.getElementById("controls"),T=document.getElementById("resolution-slider"),oe=document.getElementById("resolution-input"),fe=document.getElementById("resolution-error"),U=document.getElementById("bg-color-picker"),j=document.getElementById("fg-color-picker"),ae=document.getElementById("char-input"),$=document.getElementById("download-btn"),Ae=$.querySelector("span"),Qe=document.getElementById("invert-btn"),et=document.getElementById("invert-chars-btn"),tt=document.getElementById("progress-container"),Me=document.getElementById("progress-bar"),V=document.getElementById("preset-select"),A=document.getElementById("download-width-input"),R=document.getElementById("download-height-input"),q=document.getElementById("aspect-ratio-toggle"),X=document.getElementById("download-size-slider"),nt=50;let J=[".","<",">","/","1","0"],O=[],S=null,ne=!1,N=null,Q=[],M=[],ee=null,z=0,he=null,H=1,E=!0,Re,Fe;async function We(s){const d=[...new Set(s)];if(d.length===0)return[];const r=document.createElement("canvas"),h=r.getContext("2d",{willReadFrequently:!0});if(!h)return d;const u=24;r.width=u,r.height=u,h.font=`bold ${u}px "Roboto Mono", monospace`,h.textAlign="center",h.textBaseline="middle";const o=[];for(const l of d){h.fillStyle="#000",h.fillRect(0,0,u,u),h.fillStyle="#fff",h.fillText(l,u/2,u/2);const y=h.getImageData(0,0,u,u).data;let v=0;for(let m=0;m<y.length;m+=4)y[m]>0&&v++;o.push({char:l,density:v})}return o.sort((l,y)=>l.density-y.density),o.map(l=>l.char)}function te(s){tt.style.display=s?"flex":"none",s&&(Me.style.width="0%")}function pe(s){Me.style.width=`${s}%`}function Oe(s){if(O.length===0)return null;const d=parseInt(T.value,10),r=s.width||s.width,h=s.height||s.height,u=r/h,o=d,l=Math.round(o/u*.55),y=document.createElement("canvas");y.width=o,y.height=l;const v=y.getContext("2d",{willReadFrequently:!0});if(!v)return null;v.drawImage(s,0,0,o,l);const m=v.getImageData(0,0,o,l).data,n=[];for(let e=0;e<l;e++)for(let t=0;t<o;t++){const f=(e*o+t)*4,g=m[f],c=m[f+1],i=m[f+2],a=m[f+3];let p="";if(a>nt){const w=(.299*g+.587*c+.114*i)/255,b=Math.min(O.length-1,Math.floor(w*O.length)),x=O[b];x&&(p=x)}p&&n.push({char:p,x:t,y:e})}return{asciiData:n,numCols:o,numRows:l,aspectRatio:u}}function Ue(s,d,r){const h=s.getContext("2d");if(!h)return;if(!d||!d.asciiData||!d.aspectRatio){h.fillStyle=r.bgColor,h.fillRect(0,0,s.width,s.height);return}const{asciiData:u,numCols:o,numRows:l,aspectRatio:y}=d,{bgColor:v,fgColor:m}=r,n=s.width,e=s.height;h.fillStyle=v,h.fillRect(0,0,n,e);let t,f;n/e>y?(f=e,t=e*y):(t=n,f=n/y);const g=(n-t)/2,c=(e-f)/2,i=t/o,a=f/l;h.font=`bold ${a}px "Roboto Mono", monospace`,h.fillStyle=m,h.textAlign="center",h.textBaseline="middle";for(const p of u){const w=g+p.x*i+i/2,b=c+p.y*a+a/2;h.fillText(p.char,w,b)}}function qe(s){var e;const d=B.getContext("2d");if(!d)return;const r=U.value;if(!s||!s.asciiData||!s.aspectRatio){d.fillStyle=r,d.fillRect(0,0,B.width,B.height);return}const{asciiData:h,numCols:u,numRows:o,aspectRatio:l}=s,y=j.value,v=((e=B.parentElement)==null?void 0:e.clientWidth)||800;B.width=v,B.height=B.width/l,d.fillStyle=r,d.fillRect(0,0,B.width,B.height);const m=B.width/u,n=B.height/o;d.font=`bold ${n}px "Roboto Mono", monospace`,d.fillStyle=y,d.textAlign="center",d.textBaseline="middle";for(const t of h)d.fillText(t.char,t.x*m+m/2,t.y*n+n/2)}function ye(){ee&&(clearTimeout(ee),ee=null)}function ge(){if(ye(),!ne||M.length===0)return;const s=M[z];if(!s){z=(z+1)%M.length,ee=window.setTimeout(ge,100);return}qe(s.data);const d=s.delay;z=(z+1)%M.length,ee=window.setTimeout(ge,d)}async function rt(){ye(),te(!0),G.setAttribute("disabled","true"),await new Promise(u=>setTimeout(u,20)),M=[];const s=document.createElement("canvas"),d=s.getContext("2d");if(!d||!N){te(!1),G.removeAttribute("disabled"),console.error("GIF processing error: No GIF data available.");return}const r=N.lsd.width,h=N.lsd.height;s.width=r,s.height=h;for(let u=0;u<Q.length;u++){const o=Q[u],{width:l,height:y,top:v,left:m}=o.dims,n=d.createImageData(l,y);n.data.set(o.patch),d.putImageData(n,m,v);const e=Oe(s);e?M.push({data:e,delay:o.delay}):M.push({data:null,delay:o.delay}),o.disposalType===2&&d.clearRect(m,v,l,y),pe((u+1)/Q.length*100),u%5===0&&await new Promise(t=>setTimeout(t,0))}te(!1),G.removeAttribute("disabled"),z=0,ge()}async function K(){if(!S)return;const s=parseInt(oe.value,10),d=parseInt(T.min,10),r=parseInt(T.max,10);if(isNaN(s)||s<d||s>r){fe.textContent=`Resolução deve ser entre ${d} e ${r}.`,fe.style.display="block",$.disabled=!0;return}if(fe.style.display="none",$.disabled=!1,ne)await rt();else{te(!0),G.setAttribute("disabled","true"),await new Promise(u=>setTimeout(u,20));const h=Oe(S);he=h,pe(50),await new Promise(u=>setTimeout(u,20)),qe(h),pe(100),te(!1),G.removeAttribute("disabled")}}function ie(){clearTimeout(Re),Re=window.setTimeout(K,150)}function Pe(s){if(s==="slider")oe.value=T.value;else{const d=parseInt(oe.value,10);!isNaN(d)&&d>=parseInt(T.min)&&d<=parseInt(T.max)&&(T.value=d.toString())}}function it(s){var u;ye();const r=(u=s.target.files)==null?void 0:u[0];if(!r)return;const h=new FileReader;ne=r.type==="image/gif",h.onload=o=>{var y;Ke.style.display="none",Je.style.display="grid";const l=new Image;l.onload=()=>{S=l,H=l.naturalWidth/l.naturalHeight,A.value=l.naturalWidth.toString(),R.value=l.naturalHeight.toString();const v=Math.max(l.naturalWidth,l.naturalHeight);if(X.value=Math.min(v,parseInt(X.max)).toString(),V.value="original",E=!0,q.classList.add("locked"),q.innerHTML="&#128279;",Ye.src=l.src,ne){const m=new FileReader;m.onload=n=>{var t;const e=(t=n.target)==null?void 0:t.result;N=Ee.parseGIF(e),Q=Ee.decompressFrames(N,!0),K()},m.readAsArrayBuffer(r)}else N=null,Q=[],K()},l.src=(y=o.target)==null?void 0:y.result},h.readAsDataURL(r)}function ot(){if(!he)return;const s=document.createElement("canvas");s.width=parseInt(A.value,10)||800,s.height=parseInt(R.value,10)||600,Ue(s,he,{bgColor:U.value,fgColor:j.value});const d=s.toDataURL("image/png"),r=document.createElement("a");r.download="ascii-art.png",r.href=d,document.body.appendChild(r),r.click(),document.body.removeChild(r)}async function at(){$.disabled=!0,Ae.textContent="Gerando GIF...";const s=new Xe({workers:2,quality:10,workerScript:"./gif.worker.js",background:U.value}),d=document.createElement("canvas");d.width=parseInt(A.value,10)||800,d.height=parseInt(R.value,10)||600;for(const r of M)Ue(d,r.data,{bgColor:U.value,fgColor:j.value}),s.addFrame(d,{copy:!0,delay:r.delay});s.on("finished",r=>{const h=URL.createObjectURL(r),u=document.createElement("a");u.download="ascii-art.gif",u.href=h,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(h),$.disabled=!1,Ae.textContent="Baixar Arte"}),s.render()}function st(){const s=U.value,d=j.value;U.value=d,j.value=s,K()}function lt(){O.reverse(),K()}function ut(){clearTimeout(Fe),Fe=window.setTimeout(async()=>{const s=ae.value;s.length<3||(J=[...new Set(s.split(""))],ae.value=J.join(""),G.setAttribute("disabled","true"),O=await We(J),K())},400)}function ve(){const s=parseInt(A.value,10),d=parseInt(R.value,10);if(isNaN(s)||isNaN(d))return;const r=Math.max(s,d);X.value=Math.min(r,parseInt(X.max)).toString()}function me(s){if(!E){V.value="custom",ve();return}const d=parseInt(A.value,10),r=parseInt(R.value,10);s==="width"&&d>0?R.value=Math.round(d/H).toString():s==="height"&&r>0&&(A.value=Math.round(r*H).toString()),V.value="custom",ve()}function ct(){const s=V.value;if(s==="custom"){E=!1,q.classList.toggle("locked",E),q.innerHTML="&#128278;";return}if(s==="original")A.value=(S==null?void 0:S.naturalWidth.toString())||"800",R.value=(S==null?void 0:S.naturalHeight.toString())||"600",E||we();else{const[d,r]=s.split("x");A.value=d,R.value=r}ve()}function dt(){const s=parseInt(X.value,10);let d,r;H>=1?(d=s,r=Math.round(s/H)):(r=s,d=Math.round(s*H)),A.value=d.toString(),R.value=r.toString(),E||we(),V.value="custom"}function we(){E=!E,q.classList.toggle("locked",E),q.innerHTML=E?"&#128279;":"&#128278;",E&&S&&me("width")}(async()=>(O=await We(J),ae.value=J.join(""),Se.addEventListener("change",it),Ze.addEventListener("click",()=>Se.click()),T.addEventListener("input",()=>{Pe("slider"),ie()}),oe.addEventListener("input",()=>{Pe("input"),ie()}),U.addEventListener("input",ie),j.addEventListener("input",ie),ae.addEventListener("input",ut),$.addEventListener("click",()=>ne?at():ot()),Qe.addEventListener("click",st),et.addEventListener("click",lt),A.addEventListener("input",()=>me("width")),R.addEventListener("input",()=>me("height")),V.addEventListener("change",ct),q.addEventListener("click",we),X.addEventListener("input",dt)))();
